generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Merchant {
  id            String   @id @default(cuid())
  name          String
  apiKey        String   @unique
  webhookUrl    String?
  webhookSecret String?  // for HMAC signing; if missing, apiKey is used
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  paymentLinks PaymentLink[]
  payouts      Payout[]
}

model PaymentLink {
  id          String   @id @default(cuid())
  merchantId  String
  amount      String
  currency    String   @default("USDC")
  description String?
  status      String   @default("pending") // pending | paid | expired
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  merchant Merchant @relation(fields: [merchantId], references: [id], onDelete: Cascade)
}

model Payout {
  id           String   @id @default(cuid())
  merchantId   String
  amount       String
  destination String?
  status       String   @default("requested") // requested | processing | completed | failed
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  merchant Merchant @relation(fields: [merchantId], references: [id], onDelete: Cascade)
}
